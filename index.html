<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Report Request</title>
  <style>
    /* Add basic CSS for form layout */
    body {
      font-family: Arial, sans-serif;
    }
    form {
      margin: 20px;
    }
    label {
      margin-bottom: 8px;
    }
    select, input[type="email"] {
      min-width: 250px; /* Set a minimum width for dropdowns and email field */
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
    th {
      background-color: #f2f2f2;
    }
    input[type="date"] {
      text-align: center;
    }
    .pagination {
      margin: 20px 0;
      text-align: center;
    }
    .pagination button {
      margin: 0 5px;
      padding: 5px 10px;
    }
    
    /* Spreadsheet header style */
    .spreadsheet-header {
      display: flex;
      flex-wrap: wrap; /* Allow buttons to wrap */
      margin-bottom: 20px;
      border-bottom: 2px solid #ccc;
      padding-bottom: 20px;
    }
    .spreadsheet-header .toggle-btn {
      flex: 1 1 auto; /* Allow buttons to grow and shrink */
      padding: 10px; /* Adjust padding for better look */
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      cursor: pointer;
      text-align: center;
      margin: 5px; /* Spacing between buttons */
      word-wrap: break-word; /* Ensure words wrap within the button */
    }
    .spreadsheet-header .toggle-btn.selected {
      background-color: #007bff;
      color: white;
    }
    
  </style>
</head>
<body>
  <h1>Request a Report</h1>
  
  <form id="reportForm">
    <label for="reportType">Report Type:</label>
    <select id="reportType" required>
      <option value="">Select a report type</option>
      <option value="loyalty_daily_performance">Loyalty Daily Performance</option>
      <option value="redemptions_events_report">Redemptions and Events Report</option>
      <!-- Add other report types here -->
    </select><br><br>

    <label for="startDate">Start Date:</label>
    <input type="date" id="startDate" required><br><br>

    <label for="endDate">End Date:</label>
    <input type="date" id="endDate" required><br><br>

    <label for="filterByStore">Filter by Store:</label>
    <select id="filterByStore" name="store_ids" >
      <!-- Options will be populated dynamically from an API call -->
    </select><br><br>

    <label for="filterByStoreList">Filter by Store List:</label>
    <select id="filterByStoreList" name="store_list_id" >
      <!-- Options will be populated dynamically from an API call -->
    </select><br><br>

    <label for="email">Email Address:</label>
    <input type="email" id="email" required><br><br>
    
    <label for="columns"><b>Pick your Data - </b>don't worry there won't be any empty columns:</label><br>
    <button type="button" id="selectAllBtn">Select All</button><br><br>
    <div class="spreadsheet-header" id="columns">
      <!-- Columns will be dynamically inserted here based on the selected report type -->
    </div>
    <button type="submit">Submit Request</button>
    <div id="dateError" style="color: red;"></div>
  </form>

  <script>
    const columnsData = {
      loyalty_daily_performance: [
        { value: "Business Day", label: "BusinessDay <i>xx/xx/xxxx </i>" },
        { value: "Loyalty Program ID", label: "ProgramID" },
        { value: "Store ID", label: "StoreID" },
        { value: "Store Number", label: "Store Number" },
        { value: "Total Number of Transactions", label: "<b>Total (#)</b> - <i>AllTransactions</i>" },
        { value: "Total Number of Loyalty Transactions", label: "Total (#)- LoyaltyTransactions" },
        { value: "Total Number of Anonymous Transactions", label: "Total Number of Anonymous Transactions" },
        { value: "Rewards Redeemed", label: "Rewards Redeemed" },
        { value: "Total Discounts", label: "Total Discounts" },
        { value: "Subtotal for all Transactions", label: "Subtotal - All Transactions" },
        { value: "Subtotal for all Loyalty Transactions", label: "Subtotal - all Loyalty Transactions" },
        { value: "Subtotal for all Anonymous Transactions", label: "Subtotal - all Anonymous Transactions" },
        { value: "Subtotal for all Transactions", label: "<b>All Transactions-</b><i>Subtotal</i>" },
        { value: "Average Transactions Subtotal", label: "Average Transactions Subtotal" },
        { value: "Average Loyalty Transaction Subtotal", label: "Average Loyalty Transaction Subtotal" },
        { value: "Average Anonymous Transaction Subtotal", label: "Average Anonymous Transaction Subtotal" }
      ],
      redemptions_events_report: [
        { value: "Event Date", label: "Event Date" },
        { value: "Event Type", label: "Event Type" },
        { value: "Redemption Count", label: "Redemption Count" },
        { value: "Redemption Value", label: "Redemption Value" },
        { value: "Store ID", label: "StoreID" },
        { value: "Store Number", label: "Store Number" },
        { value: "Total Discounts", label: "Total Discounts" },
        { value: "Total Rewards", label: "Total Rewards" },
        { value: "Date", label: "Date" },
        { value: "ID", label: "ID" },
        { value: "Code", label: "Code" },
        { value: "Store", label: "Store" },
        { value: "Sales", label: "Sales" },
        { value: "Total", label: "Total" },
        { value: "Extra Column 1", label: "Extra 1" },
        { value: "Extra Column 2", label: "Extra 2" },
      ]
      // Add other report types and their columns here
    };
    document.getElementById('reportType').addEventListener('change', function() {
    const selectedReportType = this.value;
    const columnsContainer = document.getElementById('columns');
    const buttons = columnsContainer.querySelectorAll('.toggle-btn');
    
    buttons.forEach(button => {
      button.innerHTML = '';
      button.style.visibility = 'hidden';
      button.classList.remove('selected');
    });

    if (columnsData[selectedReportType]) {
      columnsData[selectedReportType].forEach((column, index) => {
        if (buttons[index]) {
          buttons[index].innerHTML = column.label;
          buttons[index].dataset.value = column.value;
          buttons[index].style.visibility = 'visible';
        }
      });
    }
  });

  // Validate dates
  function validateDates() {
    // Existing validation logic...
  }

// Function to validate the date inputs
function validateDates() {
  const startDateInput = document.getElementById('startDate');
  const endDateInput = document.getElementById('endDate');
  const startDate = new Date(startDateInput.value);
  const endDate = new Date(endDateInput.value);
  const errorMessage = document.getElementById('dateError');
  const submitButton = document.querySelector('button[type="submit"]');

  // Check if dates are valid
  if (!startDateInput.value || !endDateInput.value) {
    errorMessage.textContent = "Please enter both start and end dates.";
    submitButton.disabled = true; // Disable submit button
    return false;
  }

  // Check if start date is before end date
  if (startDate > endDate) {
    errorMessage.textContent = "Start date must be before end date.";
    submitButton.disabled = true; // Disable submit button
    return false;
  }

  errorMessage.textContent = ""; // Clear any error message
  submitButton.disabled = false; // Enable submit button
  return true;
}

// Add event listeners for validation
document.getElementById('startDate').addEventListener('change', validateDates);
document.getElementById('endDate').addEventListener('change', validateDates);
  document.querySelectorAll('.toggle-btn').forEach(button => {
    button.addEventListener('click', () => {
      button.classList.toggle('selected');
    });
  });

    function createButtons(reportType) {
      const columnsContainer = document.getElementById('columns');
      columnsContainer.innerHTML = ''; // Clear any existing buttons

      if (columnsData[reportType]) {
        columnsData[reportType].forEach((column) => {
          const button = document.createElement('button');
          button.type = 'button';
          button.className = 'toggle-btn';
          button.innerHTML = column.label;
          button.dataset.value = column.value;

          // Check localStorage for previously selected columns
          const selectedColumns = JSON.parse(localStorage.getItem(`${reportType}_selectedColumns`)) || [];
          if (selectedColumns.includes(column.value)) {
            button.classList.add('selected');
          }

          button.addEventListener('click', () => {
            button.classList.toggle('selected');

            // Update localStorage on button click
            const currentSelections = JSON.parse(localStorage.getItem(`${reportType}_selectedColumns`)) || [];
            if (button.classList.contains('selected')) {
              currentSelections.push(column.value);
            } else {
              const index = currentSelections.indexOf(column.value);
              if (index > -1) {
                currentSelections.splice(index, 1);
              }
            }
            localStorage.setItem(`${reportType}_selectedColumns`, JSON.stringify(currentSelections));
          });

          columnsContainer.appendChild(button);
        });
      }
    }

    // Load selected report type from localStorage on page load
    window.addEventListener('DOMContentLoaded', () => {
      const savedReportType = localStorage.getItem('selectedReportType');
      if (savedReportType) {
        document.getElementById('reportType').value = savedReportType;
        createButtons(savedReportType);
      }

      // Load other inputs from localStorage
      const savedStartDate = localStorage.getItem('startDate');
      const savedEndDate = localStorage.getItem('endDate');
      const savedEmail = localStorage.getItem('email');

      if (savedStartDate) {
        document.getElementById('startDate').value = savedStartDate;
      }
      if (savedEndDate) {
        document.getElementById('endDate').value = savedEndDate;
      }
      if (savedEmail) {
        document.getElementById('email').value = savedEmail;
      }
    });

    // Save selected report type and inputs to localStorage
    document.getElementById('reportType').addEventListener('change', function() {
      const selectedReportType = this.value;
      localStorage.setItem('selectedReportType', selectedReportType);
      createButtons(selectedReportType);
      
      // Load previously selected columns
      const selectedColumns = JSON.parse(localStorage.getItem(`${selectedReportType}_selectedColumns`)) || [];
      const buttons = document.querySelectorAll('.toggle-btn');
      buttons.forEach(button => {
        if (selectedColumns.includes(button.dataset.value)) {
          button.classList.add('selected');
        } else {
          button.classList.remove('selected');
        }
      });
    });

    // Save inputs to localStorage on change
    document.getElementById('startDate').addEventListener('input', function() {
      localStorage.setItem('startDate', this.value);
    });

    document.getElementById('endDate').addEventListener('input', function() {
      localStorage.setItem('endDate', this.value);
    });

    document.getElementById('email').addEventListener('input', function() {
      localStorage.setItem('email', this.value);
    });

    document.getElementById('selectAllBtn').addEventListener('click', function() {
      const buttons = document.querySelectorAll('.toggle-btn');
      const isAllSelected = Array.from(buttons).every(button => button.classList.contains('selected'));

      if (isAllSelected) {
        // Deselect all
        buttons.forEach(button => {
          button.classList.remove('selected');
        });
        this.textContent = 'Select All';
        localStorage.setItem(`${document.getElementById('reportType').value}_selectedColumns`, JSON.stringify([]));
      } else {
        // Select all
        buttons.forEach(button => {
          button.classList.add('selected');
        });
        this.textContent = 'Deselect All';

        const allSelectedValues = Array.from(buttons).map(button => button.dataset.value);
        localStorage.setItem(`${document.getElementById('reportType').value}_selectedColumns`, JSON.stringify(allSelectedValues));
      }
    });
  </script>
</body>
</html>
